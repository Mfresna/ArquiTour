<header>
  <div id="panel-izquierda" tabindex="-1">
    <!-- Si es chico cambia el logo por el boton hamburguesa -->

      <!-- btn hamburguesa -->
     <button
      type="button"
      class="menu-toggle-btn"
      (click)="toggleMenuLateral()">
      <span class="material-icons">menu</span>
    </button>

      <!-- logo -->
    <a routerLink="/" id="logo-container">
      <img 
        src="assets/img/logo.png"
        alt="ArquiTour Logo"
        id="logo">
    </a>
  </div>

  @if(!isLogged()){
    <div id="panel-central">
      <ul class="nav-desktop">
          @if(isBienvenida){
            <li>
              <a class="boton" routerLink="/">INICIO</a>
            </li>
          }
          @if(!isBienvenida){
            <li>
              <div id="panel-nosotros">
                <a class="boton" routerLink="/bienvenida"
                [class.activo]="isBienvenida">NOSOTROS</a>
              </div>
            </li>
          }  
        </ul>
    </div>


    <div id="panel-derecha">
        <button id="modo-noche-publico" (click)="toggleModoNoche()">
          <span
          id="noche-toggle-publico"
          class="material-icons icon-modo-publico"
          [class.activo]="modoNoche">
          {{ modoNoche ? 'light_mode' : 'brightness_3' }}
          </span>
        </button>
    </div>
  }

  @if(isLogged()){

    <div id="panel-central">
    <ul>
      <li>
        <div id="panel-obras">
          @if(!isArq() && !isAdmin()){
            <a routerLink="/obras" class="boton">OBRAS</a>
          }@else{
            <a class="boton" (click)="toggleObrasMenu()">OBRAS</a>

            @if(obrasMenu){
              <div id="menu-obras" 
                class="menu-desplegable bordes-radius">

                <a (click)="cerrarTodosMenus()" routerLink="/obras">Ver Obras</a>
                <a (click)="cerrarTodosMenus()" routerLink="/formObras">Registrar Obra</a>
    

              </div>
            }

          }
            
        </div>
      </li>

      <li>
        <div id="panel-estudios">
          @if(!isArq() && !isAdmin()){
            <a (click)="cerrarTodosMenus()" routerLink="/estudios" class="boton">ESTUDIOS</a>
          }@else{
            <a class="boton" (click)="toggleEstudiosMenu()">ESTUDIOS</a>

            @if(estudiosMenu){
              <div id="menu-estudios" 
                class="menu-desplegable bordes-radius">

                <a (click)="cerrarTodosMenus()" routerLink="/estudios">Ver Estudios</a>
                <a (click)="cerrarTodosMenus()" routerLink="/formEstudios">Crear Estudio</a>
                
              </div>
            }

          }
            
        </div>
      </li> 
      <li>
        <div id="panel-mapas">
            <a class="boton" (click)="toggleMapaMenu()">MAPA</a>

            @if(mapaMenu){
              <div id="menu-mapas" 
                class="menu-desplegable bordes-radius">

                <a (click)="cerrarTodosMenus()" routerLink="/mapa">Ver Mapa</a>
                <a (click)="cerrarTodosMenus()" routerLink="/obras-cercanas">Ver Obras Cercanas</a>
                
              </div>
            }            
        </div>      
      </li>
      <li><a (click)="cerrarTodosMenus()" class="boton" routerLink="/favoritos">FAVORITOS</a></li>
    </ul>

    </div>
  
    <div id="panel-derecha">

      <div id="contenedor-notificaciones"
          (click)="abrirNotificaciones()"
          tabindex="0"
          (keydown.enter)="abrirNotificaciones()">

        <span
          id="notificaciones"
          class="material-icons span-menu"
          tabindex="-1">
            notifications
        </span>

        <!-- Badge solo si hay notificaciones sin leer -->
        @if (cantNotifSinLeer$ | async; as count) {
          @if (count > 0) {
            <span 
              class="badge-notificaciones"
              [class.un-digito]="count < 10"
              [class.dos-digitos]="count >= 10">

                {{ count > 99 ? '99+' : count }}

            </span>
          }
        }

        <!-- Menu de Notificaciones -->
        @if(notificacionesMenu){
          <div id="menu-notificaciones" 
            class="menu-desplegable bordes-radius-inf borde-sup-izq">

            <div id="lista-notificaciones">

              <!-- Lista no tificaciones -->
               @if(notificaciones.length === 0) {
                  <p class="sin-notificaciones">No tenés notificaciones</p>
                } @else {

                  @for (notif of notificaciones; track notif.id) {

                    <div class="item-notificacion"
                      (click)="seleccionarNotificacion(notif)">

                      <div id="contenido-notificacion">

                        @if(notif.tipo != TipoNotificacionEnum.CAMBIO_ROL){
                          <p class="titulo-notif">{{TipoNotificacionDescripcion[notif.tipo]}}</p>
                        }
                        <p class="mensaje-notif">{{ notif.mensaje }}</p>
                      </div>

                      @if(!notif.isLeido){
                        <span class="estado-notif"></span>
                      }

                    
                    </div>
                  }

                }
              
            </div>
            
            <hr>  <!--MENU INFERIOR -->

            <a id="btn-leer-todas"
              (click)="marcarTodasLeidas()"
              >
              Marcar Todas Leídas
            </a>

          </div>
        }

      </div>

      <button
        id="usuario"
        class="user-avatar-btn"
        type="button"
        (click)="toggleUsuarioMenu()"
        (keydown.escape)="toggleUsuarioMenu()"
        tabindex="0">

        <img
        [src]="imagenPerfilUrl"
        alt="Usuario"
        (error)="imagenError($event)"
        />
      </button>

      @if(usuarioMenu){
        <div id="menu-usuario" 
          class="menu-desplegable bordes-radius-inf borde-sup-izq">

          <a (click)="cerrarSesion()">Cerrar Sesion
            <span id="logout" class="material-icons user-icon-trigger">logout</span>
          </a>
          <a (click)="cerrarTodosMenus()" routerLink="/me">Ver mi Perfil</a>

          <a (click)="cerrarTodosMenus()" routerLink="/solicitudes">Solicitudes</a>

          @if(isAdmin()){
            <a (click)="cerrarTodosMenus()" routerLink="/gestionar-usuarios">Gestionar Usuarios</a>
          }

          <hr>
          <a id="modo-noche" (click)="toggleModoNoche()">
            Modo Noche
            <span
              id="noche-toggle"
              class="material-icons user-icon-trigger"
              [class.activo]="modoNoche">
              {{ modoNoche ? 'toggle_on' : 'toggle_off' }}
            </span>
          </a>


        </div>
      }
      

    </div>

  }

  <!-- =================================== MENU LATERAL PARA EL RESPNSIVE ============================-->
     <!-- MENÚ LATERAL MOBILE (para logueado y no logueado) -->
  @if(menuLateralAbierto) {
    <!-- Overlay semi-transparente -->
    <div
      id="drawer-overlay"
      (click)="cerrarMenuLateral()">
    </div>

    <!-- Drawer lateral -->
    <nav id="drawer-menu">
      <div class="drawer-header">
        <span class="drawer-titulo">Menú</span>
        <button
          type="button"
          class="drawer-close-btn"
          (click)="cerrarMenuLateral()">
          <span class="material-icons">close</span>
        </button>
      </div>

      <ul class="drawer-lista">

        <!-- CONTENIDO NO LOGUEADO -->
        @if(!isLogged()){
          @if(isBienvenida){
            <li>
              <a routerLink="/"
                 (click)="cerrarMenuLateral()">
                INICIO
              </a>
            </li>
          }
          @if(!isBienvenida){
            <li>
              <a routerLink="/bienvenida"
                 [class.activo]="isBienvenida"
                 (click)="cerrarMenuLateral()">
                NOSOTROS
              </a>
            </li>
          }
        }

        <!-- CONTENIDO LOGUEADO -->
        @if(isLogged()){

          <!-- Obras -->
          @if(!isArq() && !isAdmin()){
            <li>
              <a routerLink="/obras"
                 (click)="cerrarMenuLateral()">
                OBRAS
              </a>
            </li>
          } @else {
            <li class="drawer-seccion">
              <span class="drawer-seccion-titulo">OBRAS</span>
              <ul class="drawer-sublista">
                <li>
                  <a routerLink="/obras"
                     (click)="cerrarMenuLateral()">
                    Ver Obras
                  </a>
                </li>
                <li>
                  <a routerLink="/formObras"
                     (click)="cerrarMenuLateral()">
                    Registrar Obra
                  </a>
                </li>
              </ul>
            </li>
          }

          <!-- Estudios -->
          @if(!isArq() && !isAdmin()){
            <li>
              <a routerLink="/estudios"
                 (click)="cerrarMenuLateral()">
                ESTUDIOS
              </a>
            </li>
          } @else {
            <li class="drawer-seccion">
              <span class="drawer-seccion-titulo">ESTUDIOS</span>
              <ul class="drawer-sublista">
                <li>
                  <a routerLink="/estudios"
                     (click)="cerrarMenuLateral()">
                    Ver Estudios
                  </a>
                </li>
                <li>
                  <a routerLink="/formEstudios"
                     (click)="cerrarMenuLateral()">
                    Crear Estudio
                  </a>
                </li>
              </ul>
            </li>
          }

          <!-- Mapa -->
          <li class="drawer-seccion">
            <span class="drawer-seccion-titulo">MAPA</span>
            <ul class="drawer-sublista">
              <li>
                <a routerLink="/mapa"
                   (click)="cerrarMenuLateral()">
                  Ver Mapa
                </a>
              </li>
              <li>
                <a routerLink="/obras-cercanas"
                   (click)="cerrarMenuLateral()">
                  Obras Cercanas
                </a>
              </li>
            </ul>
          </li>

          <!-- Favoritos -->
          <li>
            <a routerLink="/favoritos"
               (click)="cerrarMenuLateral()">
              FAVORITOS
            </a>
          </li>
        }

      </ul>
    </nav>
  }

</header>

<app-mensaje-modal
  [isVisible]="modalVisible"
  [titulo]="modalTitulo"
  [mensaje]="modalMensaje"
  [conIcon]="false"
  [tipoContenido]="'texto'"

  [mostrarCerrar]="false"
  [mostrarBotonCancelar]="false"

  (cerrado)="modalVisible=false"

></app-mensaje-modal>