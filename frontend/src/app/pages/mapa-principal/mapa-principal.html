<div id="contenedor-mapa-obras">

    <!-- PANEL LATERAL -->
    <aside id="panel-filtros">
        <h2 class="titulo">Obras cercanas</h2>
        <div class="form-filtros">
            <!-- Distancia -->
            <fieldset class="campo">
                <label for="distancia">
                    Radio de búsqueda
                    <span class="distancia-valor">({{ distanciaKm }} km)</span>
                </label>

                <div class="distancia-control">
                    <input
                        id="distancia"
                        #slider
                        type="range"
                        min="1"
                        max="1000"
                        step="1"
                        [value]="distanciaKm"
                        (input)="onDistanciaChange(slider.value)"/>
                </div>
            </fieldset>


            <!-- Estado -->
            <fieldset class="campo">
                <label for="est">Estado</label>

                <select
                    id="est"
                    [(ngModel)]="estadoFiltro"
                    name="estadoFiltro"
                    (change)="onCambioFiltros()">

                    <option value="">-- Todos --</option>
                    @for (e of estadosDisponibles; track e) {
                        <option [value]="e">{{ estadoObraDescripcion[e] }}</option>
                    }
                </select>
            </fieldset>

            <!-- Categoría -->
            <fieldset class="campo">
                <label for="cat">Categoría</label>

                <select
                    id="cat"
                    [(ngModel)]="categoriaFiltro"
                    name="categoriaFiltro"
                    (change)="onCambioFiltros()">

                    <option value="">-- Todas --</option>
                    @for (c of categoriasDisponibles; track c) {
                        <option [value]="c">{{ categoriaObraDescripcion[c] }}</option>
                    }
                </select>
            </fieldset>
        </div>
        <!-- Lista de obras filtradas -->
        <div id="panel-scroll">
           <div class="listado-obras">
                @if (!cargando && !error) {
                    @if (!obrasFiltradas.length) {
                        <p>No se encontraron obras con los filtros actuales.</p>
                    } @else {
                        <ul>
                            @for (o of obrasFiltradas; track o.id) {
                                <li (click)="centrarEnObra(o)">
                                    <strong>{{ o.nombre }}</strong>
                                    @if (o.anioEstado) {
                                        <span> · {{ o.anioEstado }}</span>
                                    }
                                    @if (o.estado) {
                                        <span> · {{ estadoObraDescripcion[o.estado] || o.estado }}</span>
                                    }
                                </li>
                            }
                        </ul>
                    }
                }
            </div> 
        </div>
        
    </aside>

    <!-- MAPA -->
    <div id="mapa-obras-wrapper">
        
        <div id="mapa-obras"></div>

        <button
            type="button"
            id="btn-mi-ubicacion"
            (click)="irAMiUbicacion()"
            title="Ir a mi ubicación">
            
            <span class="material-icons">my_location</span>
        </button>

    </div>
    
</div>